<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>제작사례 - 드림전동차</title>
    <link rel="stylesheet" href="css/style.css?v=20260214-999">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</head>
<body>
    <!-- GNB -->
    <header class="gnb">
        <a href="index.html" class="gnb-logo main-logo-link">
            <img src="images/logo.webp" alt="DREAM EV 드림전동차" class="logo-img">
        </a>

        <nav class="gnb-nav">
            <ul class="mobile-menu-list">
                <li><a href="about.html">회사소개</a></li>
                <li><a href="cases.html">제작사례</a></li>
                <li><a href="support.html">고객센터</a></li>
                <li><a href="contact.html">견적문의</a></li>
            </ul>
        </nav>

        <button class="mobile-menu-toggle" aria-label="메뉴 열기">
            <span></span>
            <span></span>
            <span></span>
        </button>

        <a href="contact.html" class="header-btn btn-primary">견적문의</a>
    </header>

    <!-- 제작 사례 갤러리 (카테고리 선택 + 갤러리) -->
    <section class="case-page-section">
        <div class="page-header gallery-header">
            <div class="header-icon-box">
                <i class="fas fa-images"></i>
            </div>
            <div class="header-text-box">
                <h2>PORTFOLIO GALLERY</h2>
                <h3>드림전동차 제작 사례</h3>
                <p>현장의 요구에 완벽히 부응하는 맞춤형 라인업을 생생한 사진으로 확인하세요.</p>
                <button type="button" class="btn-all-cases" id="btnAllCases">전체 보기</button>
            </div>
        </div>
        <div class="case-grid-container" id="caseCategoryNav">
            <button type="button" class="case-item-card" data-category="industrial" aria-pressed="false">
                <div class="icon-box"><i class="fas fa-industry"></i></div>
                <div class="text-box">
                    <h3>산업용 전동차</h3>
                    <p>건설 및 물류 현장 최적화</p>
                </div>
            </button>
            <button type="button" class="case-item-card" data-category="agricultural" aria-pressed="false">
                <div class="icon-box"><i class="fas fa-tractor"></i></div>
                <div class="text-box">
                    <h3>농업용 전동차</h3>
                    <p>농가 환경 맞춤형 설계</p>
                </div>
            </button>
            <button type="button" class="case-item-card" data-category="multipurpose" aria-pressed="false">
                <div class="icon-box"><i class="fas fa-th-large"></i></div>
                <div class="text-box">
                    <h3>다목적 전동차</h3>
                    <p>다양한 용도의 전천후 기동</p>
                </div>
            </button>
            <button type="button" class="case-item-card" data-category="custom" aria-pressed="false">
                <div class="icon-box"><i class="fas fa-pencil-ruler"></i></div>
                <div class="text-box">
                    <h3>맞춤제작</h3>
                    <p>1:1 커스텀 제작</p>
                </div>
            </button>
        </div>
        <div class="case-gallery-wrap">
            <p class="gallery-label">선택한 카테고리의 제작 사례</p>
            <div class="gallery" id="caseGallery">
                <div class="gallery-item" data-category="industrial">
                    <img src="images/industrial.webp" alt="산업용 전동차 사례 1" loading="lazy">
                </div>
                <div class="gallery-item" data-category="industrial">
                    <img src="images/industrial.webp" alt="산업용 전동차 사례 2" loading="lazy">
                </div>
                <div class="gallery-item" data-category="agricultural">
                    <img src="images/farm.webp" alt="농업용 전동차 사례 1" loading="lazy">
                </div>
                <div class="gallery-item" data-category="agricultural">
                    <img src="images/farm.webp" alt="농업용 전동차 사례 2" loading="lazy">
                </div>
                <div class="gallery-item" data-category="multipurpose">
                    <img src="images/main2.webp" alt="다목적 전동차 사례 1" loading="lazy">
                </div>
                <div class="gallery-item" data-category="multipurpose">
                    <img src="images/main2.webp" alt="다목적 전동차 사례 2" loading="lazy">
                </div>
                <div class="gallery-item" data-category="custom">
                    <img src="images/custom.webp" alt="맞춤제작 사례 1" loading="lazy">
                </div>
                <div class="gallery-item" data-category="custom">
                    <img src="images/custom.webp" alt="맞춤제작 사례 2" loading="lazy">
                </div>
            </div>
        </div>
    </section>

    <footer class="common-footer" id="contact">
        <div class="footer-container">
            <div class="footer-content">
                <div class="footer-section brand-section">
                    <h2>드림전동차</h2>
                    <p class="slogan">현장이 신뢰하는 기술, 변치 않는 내구성</p>
                </div>
                <div class="footer-section contact-section">
                    <h3>고객지원 센터</h3>
                    <p class="desc">친절하고 상세하게 안내해 드립니다.</p>
                    <div class="phone-box">
                        <a href="tel:010-3789-7653" class="phone-number">010-3789-7653</a>
                    </div>
                    <p class="work-time">평일 09:00 - 18:00 (주말/공휴일 휴무)</p>
                </div>
                <div class="footer-section info-section">
                    <h3>사업자 정보</h3>
                    <address>
                        <p class="addr">본사/공장 : 경기도 양주시 광적면 부흥로 956번길 174</p>
                        <p class="biz-info">사업자등록번호 : 560-86-02294 | 대표 : 배창호</p>
                    </address>
                </div>
            </div>
            <div class="footer-bottom">
                <p>© 2026 Dream EV. All Rights Reserved.</p>
            </div>
        </div>
    </footer>

    <script src="js/script.js"></script>
    <script>
        // Mobile Menu Toggle - 기존 코드 주석 처리
        /*
        (function() {
            var menuToggle = document.getElementById('mobileMenuToggle');
            var menuDrawer = document.getElementById('mobileMenuDrawer');
            
            if (!menuToggle || !menuDrawer) return;
            
            function toggleMenu() {
                var isActive = menuDrawer.classList.contains('active');
                
                if (isActive) {
                    menuDrawer.classList.remove('active');
                    menuToggle.classList.remove('active');
                    document.body.style.overflow = '';
                } else {
                    menuDrawer.classList.add('active');
                    menuToggle.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
            }
            
            function closeMenu() {
                menuDrawer.classList.remove('active');
                menuToggle.classList.remove('active');
                document.body.style.overflow = '';
            }
            
            menuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleMenu();
            });
            
            // Close menu when clicking overlay
            var overlay = menuDrawer.querySelector('.mobile-menu-overlay');
            if (overlay) {
                overlay.addEventListener('click', closeMenu);
            }
            
            // Close menu when clicking menu links
            var menuLinks = menuDrawer.querySelectorAll('.mobile-menu-list a');
            menuLinks.forEach(function(link) {
                link.addEventListener('click', function() {
                    setTimeout(closeMenu, 100);
                });
            });
            
            // Close menu on ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && menuDrawer.classList.contains('active')) {
                    closeMenu();
                }
            });
        })();
        */

        // Load CMS cases data
        (function() {
            var gallery = document.getElementById('gallery');
            if (!gallery) return;

            // Category mapping: 한글 -> 영문
            var categoryMap = {
                '산업용': 'industrial',
                '농업용': 'agricultural',
                '다목적': 'multipurpose',
                '맞춤제작': 'custom'
            };

            // Parse frontmatter from markdown content
            function parseFrontmatter(content) {
                var frontmatter = {};
                var body = '';
                var match = content.match(/^---\s*\n([\s\S]*?)\n---\s*\n([\s\S]*)$/);
                if (match) {
                    var fmText = match[1];
                    body = match[2] || '';
                    var lines = fmText.split('\n');
                    lines.forEach(function(line) {
                        var colonIndex = line.indexOf(':');
                        if (colonIndex > 0) {
                            var key = line.substring(0, colonIndex).trim();
                            var value = line.substring(colonIndex + 1).trim().replace(/^["']|["']$/g, '');
                            frontmatter[key] = value;
                        }
                    });
                }
                frontmatter.body = body;
                return frontmatter;
            }

            // Create gallery item from CMS data
            function createGalleryItem(data) {
                var item = document.createElement('div');
                item.className = 'gallery-item';
                item.setAttribute('data-category', data.category);
                // Store case data for modal
                item.setAttribute('data-case-title', data.title || '');
                item.setAttribute('data-case-category', data.categoryLabel || '');
                item.setAttribute('data-case-image', data.image || '');
                item.setAttribute('data-case-body', data.body || '');
                
                var img = document.createElement('img');
                img.src = data.image;
                img.alt = data.title || '제작사례';
                img.loading = 'lazy';
                img.decoding = 'async';
                
                item.appendChild(img);
                
                // Add click event
                item.addEventListener('click', function() {
                    openCaseModal(data);
                });
                
                return item;
            }

            // Load cases from GitHub
            function loadCases() {
                // GitHub API: Get folder contents
                var apiUrl = 'https://api.github.com/repos/dreamev5031/dreamev/contents/public/content/cases';
                
                fetch(apiUrl)
                    .then(function(response) {
                        if (!response.ok) {
                            throw new Error('Failed to load cases');
                        }
                        return response.json();
                    })
                    .then(function(files) {
                        // Filter markdown files
                        var mdFiles = files.filter(function(file) {
                            return file.type === 'file' && file.name.endsWith('.md');
                        });

                        if (mdFiles.length === 0) {
                            console.log('No CMS cases found');
                            return;
                        }

                        // Load each markdown file
                        var promises = mdFiles.map(function(file) {
                            return fetch(file.download_url)
                                .then(function(response) { return response.text(); })
                                .then(function(content) {
                                    var frontmatter = parseFrontmatter(content);
                                    var category = categoryMap[frontmatter.category] || frontmatter.category.toLowerCase();
                                    
                                    return {
                                        title: frontmatter.title || '',
                                        category: category,
                                        categoryLabel: frontmatter.category || '',
                                        image: frontmatter.image || '',
                                        date: frontmatter.date || '',
                                        body: frontmatter.body || ''
                                    };
                                })
                                .catch(function(err) {
                                    console.error('Error loading file:', file.name, err);
                                    return null;
                                });
                        });

                        Promise.all(promises)
                            .then(function(cases) {
                                // Filter out null values
                                cases = cases.filter(function(c) { return c && c.image; });
                                
                                // Create gallery items and prepend to gallery (CMS items appear first)
                                cases.forEach(function(caseData) {
                                    var item = createGalleryItem(caseData);
                                    gallery.insertBefore(item, gallery.firstChild);
                                });

                                // Update filter to include new CMS items
                                if (window.filterGallery) {
                                    window.filterGallery(window.currentFilter || 'all');
                                }
                            })
                            .catch(function(err) {
                                console.error('Error processing cases:', err);
                            });
                    })
                    .catch(function(err) {
                        console.error('Error loading cases from GitHub:', err);
                    });
            }

            // Load cases on page load
            loadCases();
        })();

        // Modal functionality
        (function() {
            var modal = document.getElementById('caseModal');
            var modalClose = document.getElementById('modalClose');
            var modalImage = document.getElementById('modalImage');
            var modalCategory = document.getElementById('modalCategory');
            var modalTitle = document.getElementById('modalTitle');
            var modalContent = document.getElementById('modalContent');
            var modalOverlay = modal ? modal.querySelector('.case-modal-overlay') : null;

            // Open modal with case data
            window.openCaseModal = function(caseData) {
                if (!modal) return;
                
                modalImage.src = caseData.image || '';
                modalImage.alt = caseData.title || '제작사례';
                modalTitle.textContent = caseData.title || '제작사례';
                modalCategory.textContent = caseData.categoryLabel || '';
                
                // Convert markdown to HTML
                var bodyContent = caseData.body || '';
                if (bodyContent && typeof marked !== 'undefined') {
                    modalContent.innerHTML = marked.parse(bodyContent);
                } else {
                    // Fallback: simple markdown-like conversion
                    modalContent.innerHTML = '<p>' + bodyContent.replace(/\n\n/g, '</p><p>').replace(/\n/g, '<br>') + '</p>';
                }
                
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            };

            // Close modal
            function closeModal() {
                if (!modal) return;
                modal.classList.remove('active');
                document.body.style.overflow = '';
            }

            // Close button
            if (modalClose) {
                modalClose.addEventListener('click', closeModal);
            }

            // Overlay click
            if (modalOverlay) {
                modalOverlay.addEventListener('click', closeModal);
            }

            // ESC key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && modal && modal.classList.contains('active')) {
                    closeModal();
                }
            });

            // Add click events to existing gallery items
            var existingItems = document.querySelectorAll('.gallery-item');
            existingItems.forEach(function(item) {
                item.addEventListener('click', function() {
                    var img = item.querySelector('img');
                    if (img) {
                        window.openCaseModal({
                            title: img.alt || '제작사례',
                            categoryLabel: '제작사례',
                            image: img.src,
                            body: ''
                        });
                    }
                });
            });
        })();

        // Global Footer initialization (only for support.html)
        (function() {
            // FAQ Accordion (only if FAQ section exists)
            var faqItems = document.querySelectorAll('.global-faq-section .faq-item');
            if (faqItems.length > 0) {
                faqItems.forEach(function(item) {
                    var question = item.querySelector('.faq-question');
                    var answer = item.querySelector('.faq-answer');
                    var toggle = item.querySelector('.faq-toggle');
                    
                    if (!question || !answer || !toggle) return;
                    
                    question.addEventListener('click', function() {
                        var isOpen = item.classList.contains('active');
                        
                        faqItems.forEach(function(otherItem) {
                            if (otherItem !== item) {
                                otherItem.classList.remove('active');
                                var otherToggle = otherItem.querySelector('.faq-toggle');
                                if (otherToggle) otherToggle.textContent = '+';
                            }
                        });
                        
                        if (isOpen) {
                            item.classList.remove('active');
                            toggle.textContent = '+';
                        } else {
                            item.classList.add('active');
                            toggle.textContent = '−';
                        }
                    });
                });
            }

            // Global Inquiry Form submission (only if form exists)
            var form = document.getElementById('globalInquiryForm');
            if (form) {
                form.addEventListener('submit', function(e) {
                    e.preventDefault();
                    var formData = new FormData(form);
                    var data = {};
                    formData.forEach(function(value, key) { data[key] = value; });
                    console.log('Global inquiry submitted:', data);
                    alert('상담 신청이 접수되었습니다.\n빠른 시일 내에 연락드리겠습니다.');
                    form.reset();
                });
            }
        })();

    </script>
<script>
document.addEventListener('DOMContentLoaded', () => {
    const btn = document.querySelector('.mobile-menu-toggle');
    const nav = document.querySelector('.gnb-nav');

    if (btn && nav) {
        const newBtn = btn.cloneNode(true);
        btn.parentNode.replaceChild(newBtn, btn);

        newBtn.addEventListener('click', (e) => {
            e.preventDefault();
            newBtn.classList.toggle('active');
            nav.classList.toggle('active');
            document.body.style.overflow = nav.classList.contains('active') ? 'hidden' : 'auto';
        });

        nav.querySelectorAll('a').forEach(link => {
            link.addEventListener('click', () => {
                newBtn.classList.remove('active');
                nav.classList.remove('active');
                document.body.style.overflow = 'auto';
            });
        });
    }

    // 제작 사례 갤러리: 카테고리 필터
    var categoryNav = document.getElementById('caseCategoryNav');
    var caseGallery = document.getElementById('caseGallery');
    var btnAllCases = document.getElementById('btnAllCases');
    if (categoryNav && caseGallery) {
        var cards = categoryNav.querySelectorAll('.case-item-card');
        var items = caseGallery.querySelectorAll('.gallery-item');
        var currentFilter = 'all';

        function filterGallery(category) {
            currentFilter = category;
            items.forEach(function(el) {
                var itemCat = el.getAttribute('data-category');
                if (category === 'all' || itemCat === category) {
                    el.classList.remove('hidden');
                } else {
                    el.classList.add('hidden');
                }
            });
            cards.forEach(function(c) {
                var isActive = c.getAttribute('data-category') === category;
                c.classList.toggle('active', isActive);
                c.setAttribute('aria-pressed', isActive);
            });
        }

        cards.forEach(function(card) {
            card.addEventListener('click', function() {
                filterGallery(card.getAttribute('data-category'));
            });
        });
        if (btnAllCases) {
            btnAllCases.addEventListener('click', function() { filterGallery('all'); });
        }
        filterGallery('all');
    }
});
</script>
<!-- GitHub/Decap CMS 연동: cases.json에서 제작사례 로드 (배포 전 node scripts/generate-cases-json.js 실행) -->
<script>
(function() {
    var nav = document.getElementById('caseCategoryNav');
    var gallery = document.getElementById('caseGallery');
    if (!nav && !gallery) return;

    var defaultIcons = {};
    if (nav) {
        nav.querySelectorAll('.case-item-card').forEach(function(card) {
            var cat = card.getAttribute('data-category');
            if (cat && card.querySelector('.icon-box'))
                defaultIcons[cat] = card.querySelector('.icon-box').innerHTML;
        });
    }

    fetch('/cases.json')
        .then(function(r) { return r.ok ? r.json() : []; })
        .then(function(list) {
            if (!list || !list.length) return;

            if (nav) {
                ['industrial', 'agricultural', 'multipurpose', 'custom'].forEach(function(slug) {
                    var card = nav.querySelector('.case-item-card[data-category="' + slug + '"]');
                    if (!card) return;
                    var iconBox = card.querySelector('.icon-box');
                    if (!iconBox) return;
                    var first = list.find(function(item) { return item.slug === slug && item.image; });
                    if (first)
                        iconBox.innerHTML = '<img src="/' + first.image + '" alt="" class="case-card-thumb" loading="lazy">';
                });
            }

            if (gallery && list.length) {
                var html = '';
                list.forEach(function(item) {
                    if (!item.image) return;
                    html += '<div class="gallery-item" data-category="' + item.slug + '">';
                    html += '<img src="/' + item.image + '" alt="' + (item.title || '') + '" loading="lazy">';
                    html += '</div>';
                });
                if (html) gallery.innerHTML = html;
            }
        })
        .catch(function() {});
})();
</script>
</body>
</html>
